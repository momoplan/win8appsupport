(function(){var q="buyAmt",r="DESC",i=0,o,t,c,w,e,b=false,j=window.Root,a=window.util,s=sessionStorage.getItem("userno"),p=sessionStorage.getItem("userName");var v=function(){m();f("ord_dir").addEventListener("click",k,false);f("setLono").addEventListener("click",x,false)};function m(){if(b){return}var z={command:"QueryLot",type:"querycaselot",pageindex:i,orderBy:q,orderDir:r,maxresult:5};if(o&&o!=""){z.lotno=o}j.getData(z,"buildui");b=true;console.log(z)}function y(){if(!s||s==""){f("logBtn").click()}var A=f("amount").value||0,B=f("safeAmt").value;var z={command:"betLot",bettype:"betcase",userno:s,caseid:t,amount:A,safeAmt:B};j.getData(z,"getBuyresult")}function x(){var z=event.target.getAttribute("lono");o=z;i=0;f("tog_zd").innerHTML="";f("tog_list").innerHTML="";m()}function k(A){var z=A.target,B,E=this.getElementsByTagName("p"),C=E.length;if(z.id=="ord_progress"){q="progress"}else{if(z.id=="ord_member"){q="participantCount"}else{if(z.id=="ord_sum"){q="totalAmt"}}}if(z.className=="act_asc"){r="DESC";B="act_desc"}else{if(z.className=="act_desc"){r="ASC";B="act_asc"}else{B="act_asc"}}for(var D=0;D<C;D++){E[D].className=""}z.className=B;f("tog_zd").innerHTML="";f("tog_list").innerHTML="";i=0;f("ord_dir").removeEventListener("click",k,false);m()}function d(){i++;m()}function h(D){console.log(D);if(D.error_code=="0000"){var A=D.result,B=A.length;for(var E=0;E<B;E++){var H=document.createElement("li");var I=Math.floor(Number(A[E].progress)/10);if(I<1){I=1}I=I*10;var z="tog_"+I;var C=A[E].displayIcon,G="";if(C.crown>0){G+='<img src="../images/icon/crown.png" /><span class="icon1">'+C.crown+"</span>"}if(C.cup>0){G+='<img src="../images/icon/cup.png" /><span class="icon1">'+C.cup+"</span>"}if(C.diamond>0){G+='<img src="../images/icon/diamond.png" /><span class="icon1">'+C.diamond+"</span>"}if(C.goldStar>0){G+='<img src="../images/icon/goldStar.png" /><span class="icon2">'+C.goldStar+"</span>"}var F='<div class="progress"><div class="tog_pres '+z+'"><em>进度</em><p>'+A[E].progress+'%</p></div><div class="ord_lono">'+A[E].lotName+'</div></div><div class="list_sum"><div class="top">发起人：'+A[E].starter+"&nbsp;"+G+'</div><div class="midd"><p class="totalAmt">'+A[E].totalAmt+'元</p><p class="buyAmt">'+(A[E].totalAmt-A[E].buyAmt)+'元</p><p class="safeRate red">'+A[E].safeRate+'%</p></div><div class="botm"><p class="totalAmt">方案总额</p><p class="buyAmt">剩余金额</p><p class="safeRate">保底</p>                                        </div></div>';H.innerHTML=F;b=false;if(A[E].isTop=="true"){f("tog_zd").appendChild(H)}else{f("tog_list").appendChild(H)}H.setAttribute("caseLotId",A[E].caseLotId);H.addEventListener("click",l,false);f("ord_dir").addEventListener("click",k,false)}if(D.totalPage>(i+1)){f("more").className="more";f("more").addEventListener("click",d,false)}else{f("more").className="more grey";f("more").removeEventListener("click",d,false)}}else{if(D.error_code=="0047"){var H=document.createElement("li");H.style.background="url(../images/background/blank.png) center center no-repeat";f("more").className="more grey";f("tog_list").appendChild(H);b=false}}}function l(){t=this.getAttribute("caseLotId");var z={command:"select",requestType:"caseLotDetail",id:t,};if(s!=""&&s){z.userno=s}j.getData(z,"buildInfo");f("tog_info").style.right="-284px";setTimeout(function(){f("tog_info").style.right=0},500)}function g(C){if(C.error_code=="0000"){var B=C.result;var A='<div class="info"><div class="title"><span>基本信息</span><img src="../images/btn/shrink.png" /></div><ul class="content"><li><span>方案期号：</span>'+B.batchCode+"</li><li><span>方案编号：</span>"+B.caseLotId+"</li><li><span>认购金额：</span><em>"+B.hasBuyAmt+"</em></li><li><span>保底金额：</span><em>"+B.safeAmt+"</em></li><li><span>发起人提成：</span><em>"+B.commisionRatio+"%</em></li><li><span>方案描述：</span>"+B.description+'</li></ul></div><div class="cont"><div class="title"><span>方案内容</span><img src="../images/btn/shrink.png" /></div><div class="content" id="cont"><p>'+B.betCodeHtml+'</p></div></div><div class="member"><div class="title"><span>参与人员</span><img src="../images/btn/shrink.png" /> </div><ul class="content" id="member"></ul></div>';c=B.minAmt,e=B.remainderAmt,w=(B.totalAmt-B.hasBuyAmt-B.safeAmt);f("safe_amt").innerHTML="剩余"+w+"元可保底";f("remain_amt").innerHTML="剩余"+e+"元可认购，至少认购"+c+"元";f("tog_bug").addEventListener("click",y,false);var z={command:"QueryLot",type:"caseLotBuys",caseid:t,pageindex:"0",maxresult:"10"};if(s&&s!=""){z.userno=s,z.phonenum=p}j.getData(z,"setMember");f("info_base").innerHTML=A}}function u(D){if(D.error_code=="0000"){var C=D.result,z=C.length,B="";for(var A=0;A<z;A++){B+="<li><span>"+C[A].nickName+"</span><p>"+C[A].buyTime+"</p><em>￥"+C[A].buyAmt+"</em></li>"}f("member").innerHTML=B}}function n(z){if(z.error_code=="0000"){window.location.href="success.html"}else{window.location.href="fail.html"}console.log(z)}window.getBuyresult=n;window.setMember=u;window.buildui=h;window.buildInfo=g;v();function f(z){return document.getElementById(z)||Object}})();